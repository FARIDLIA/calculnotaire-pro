Finaliser CalcuNotaire Pro pour qu‚Äôil soit imm√©diatement d√©ployable en production sans intervention ult√©rieure.
L‚Äôapplication doit √™tre s√©curis√©e, monitor√©e, conforme RGPD, mobile-first, PWA, performante, et auto-document√©e.
Ne modifier aucune logique m√©tier existante : uniquement compl√©ter l‚Äôinfrastructure, la configuration et les services pour √™tre production-ready.

1Ô∏è‚É£ D√âPLOIEMENT & ENVIRONNEMENTS

Environnements : dev, staging, prod.

Front (apps/web) : d√©ployer sur Vercel.

API (apps/api) : d√©ployer sur Render ou Fly.io.

Base PostgreSQL : Neon ou Supabase.

Stockage S3 : Scaleway ou Wasabi.

Domaines :

app.calcu-notaire.fr ‚Üí front

api.calcu-notaire.fr ‚Üí backend

admin.calcu-notaire.fr ‚Üí back-office admin

Certificats TLS/SSL actifs partout.

CI/CD GitHub Actions :

Lint, typecheck, tests, build, prisma migrate deploy, d√©ploiement.

Promotion staging ‚Üí prod manuelle.

Secrets stock√©s dans GitHub Environments (jamais commit√©s).

2Ô∏è‚É£ FICHIER .env.example
# API
PORT=3001
NODE_ENV=development

# Database
DATABASE_URL=postgres://user:pass@host:5432/dbname

# Auth
JWT_SECRET=change_me
JWT_EXPIRES_IN=7d

# Stripe
STRIPE_PUBLIC_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=

# S3 storage
S3_ENDPOINT=
S3_REGION=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_BUCKET=

# Sentry
SENTRY_DSN_WEB=
SENTRY_DSN_API=

# DVF cache
DVF_CACHE_TTL_DAYS=7

# PDF
PDF_BASE_URL=https://app.calcu-notaire.fr

3Ô∏è‚É£ OBSERVABILIT√â & SUPERVISION

Logs JSON corr√©l√©s avec req-id (API & Web).

Monitoring : endpoint /health (API + Web).

Alertes :

Sentry (erreurs web/api).

UptimeRobot (disponibilit√©).

Slack/email : erreurs > 1 %, latence p95 > 800 ms.

Metrics : req/sec, latence, 4xx/5xx, CPU/RAM.

Runbooks dans /docs/runbooks.md : incident API, rollback, rotation secrets, rejouer webhooks Stripe, purge DVF, restauration DB/S3.

4Ô∏è‚É£ S√âCURIT√â & RGPD

Headers : CSP stricte, HSTS, X-Frame-Options, X-Content-Type-Options, Referrer-Policy, Permissions-Policy.

Auth : JWT httpOnly + SameSite = Lax/Strict, refresh rotation.

Rate-limit sur /auth, /compute.

Chiffrement at-rest (DB, S3) + in-transit (TLS).

Audit OWASP Top 10 (XSS, CSRF, IDOR, injections).

RGPD :

H√©bergement UE uniquement.

Registre sous-traitants (h√©bergeur, Stripe, S3).

Conservation : 5 ans max.

Droit d‚Äôacc√®s/suppression : endpoint /me/delete.

Pages publiques : /cgu, /confidentialite, /cookies.

Banni√®re consentement (analytics off par d√©faut).

Document /docs/rgpd.md complet.

5Ô∏è‚É£ SAUVEGARDES & RESTAURATION

Backups DB quotidiens ; r√©tention 30 jours.

S3 versionn√© + lifecycle.

Test restore mensuel sur staging.

Scripts :

npm run backup:db

npm run restore:staging

6Ô∏è‚É£ PERFORMANCE & BUDGETS

Cibles Lighthouse :

LCP < 2.5 s, TTI < 3.5 s, CLS < 0.1, scores ‚â• 90.

Optimisations : next/image, lazy load, cache headers, gzip/br, CDN.

Rapport audit Lighthouse ‚Üí /docs/perf.md.

7Ô∏è‚É£ MOBILE & PWA

Responsive complet (mobile-first).

PWA :

manifest.json (icons, colors, display standalone).

service-worker.js (cache pages publiques, offline fallback).

Add-to-Home-Screen prompt + splash iOS.

Offline : consultation r√©sultats 24 h (cache local).

Tests : iPhone 12‚Äì15 Safari, Pixel 7‚Äì9 Chrome.

Lighthouse PWA ‚â• 90.

Docs : /docs/pwa.md.

8Ô∏è‚É£ PAIEMENT & FACTURATION

Stripe :

One-shot : 29‚Äì39 ‚Ç¨ / simulation.

Abonnements : Standard / Pro / Cabinet.

Webhooks idempotents + logs Admin.

Facture PDF + email (Postmark/Sendgrid).

TVA FR affich√©e.

Test webhook live avant mise en prod.

Page ‚ÄúMes paiements‚Äù dans l‚Äôespace utilisateur.

9Ô∏è‚É£ ANALYTICS PRODUIT

PostHog / Matomo (self-host UE).

√âv√©nements : completion wizard, conversion Stripe, erreurs compute.

Consentement cookies obligatoire.

Tableau /docs/analytics.md : sch√©ma √©v√©nements + dashboards.

üîü DOCUMENTATION TECHNIQUE √Ä G√âN√âRER

Cr√©er dans /docs :

deployment.md : CI/CD, DNS, secrets.

runbooks.md : incidents / rollback.

security.md : headers, rate-limit, OWASP.

rgpd.md : registre, dur√©es, droits.

pwa.md : manifest, cache, tests.

analytics.md : events, consentement.

perf.md : budgets + audits Lighthouse.

backup.md : strat√©gies & test restore.

1Ô∏è‚É£1Ô∏è‚É£ CHECKLIST GO-LIVE (OBLIGATOIRE)

 Domaines + TLS OK.

 Envs s√©par√©s (dev/staging/prod).

 CI/CD vert (lint/tests/e2e/build).

 Sentry + UptimeRobot + alertes actives.

 Backups DB/S3 test√©s.

 PWA installable/offline OK.

 CGU / Privacy / Cookies + banni√®re OK.

 PDF sign√© avec versions BOFiP / DGFiP / Service-Public.

 Paywall Stripe valide (one-shot & abo).

 Admin DMTO ‚Üí import / publication OK.

 Lighthouse ‚â• 90 (web + mobile).

‚úÖ R√©sultat attendu :
√Ä la livraison, Farid n‚Äôa plus qu‚Äô√† renseigner les variables d‚Äôenvironnement (fichier .env), lancer le pipeline de d√©ploiement, et l‚Äôapplication est int√©gralement fonctionnelle en production :
s√©curis√©e, monitor√©e, mobile, conforme RGPD et performante.