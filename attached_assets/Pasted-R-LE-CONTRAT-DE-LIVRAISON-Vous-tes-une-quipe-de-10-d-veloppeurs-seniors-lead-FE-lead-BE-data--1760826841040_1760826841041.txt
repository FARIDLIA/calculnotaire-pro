RÃ”LE & CONTRAT DE LIVRAISON
Vous Ãªtes une Ã©quipe de 10 dÃ©veloppeurs seniors (lead FE, lead BE, data, QA, DevOps).
Vous devez livrer CalcuNotaire Pro, un micro-SaaS de simulation notariale & fiscale pour la vente immobiliÃ¨re en France.
Aucune interprÃ©tation ni rÃ©duction du pÃ©rimÃ¨tre : vous exÃ©cutez strictement le prÃ©sent cahier des charges et ses Annexes Aâ†’H.
Fin de mission = tous les livrables, tests, seeds, back-office, paiements, PDF et CI/CD sont en place, verts, documentÃ©s, prod-ready.

1) Objet & portÃ©e (rÃ©sumÃ© exÃ©cutif)

CalcuNotaire Pro calcule et produit, pour Personne Physique / SCI IR / SCI IS :

Plus-value immobiliÃ¨re : base dâ€™acquisition (prix + frais dâ€™acquisition + travaux + autres), PV brute.

FiscalitÃ© particuliers : abattements (IR exonÃ©rÃ© Ã  22 ans, PS Ã  30 ans), IR 19 %, PS 17,2 %, surtaxe > 50 000 â‚¬ selon barÃ¨me BOFiP exact (avec dÃ©cotes).

ExonÃ©rations : RÃ©sidence principale ; 1re vente autre que RP + rÃ©emploi total sous 24 mois + non-propriÃ©taire de RP sur 4 ans.

SCI IS : rÃ©sultat (prix âˆ’ (VNC + frais cession)), IS 15 % / 25 %, PFU 30 % si dividendes distribuÃ©s.

Net en poche : prix âˆ’ (fiscalitÃ©) âˆ’ CRD âˆ’ IRA = min(3 % CRD ; 6 mois dâ€™intÃ©rÃªts) âˆ’ mainlevÃ©e âˆ’ (agence + diagnostics + prorata TF + divers).

DMTO France entiÃ¨re (achats) : table DGFiP versionnÃ©e par dÃ©partement (source maÃ®tresse) â†’ estimation Â« frais dâ€™acquisition Â» (rÃ©fÃ©rence usager : simulateur Notaires).

DVF : 3â€“5 comparables (INSEE + rayon), liens Etalab.

Sorties : PDF certifiÃ© (formules + rÃ©sultats + versions des barÃ¨mes + sources), CSV, partage lien, mentions lÃ©gales.

MonÃ©tisation : Paiement one-shot (29â€“39 â‚¬) par simulation (dÃ©bloque le PDF) + abonnements (Standard/Pro/Cabinet).

Back-office Admin : DMTO (import CSV & publication de version), liens de sources barÃ©miques, banniÃ¨res lÃ©gales, cache DVF, webhooks Stripe, audit.

RÃ©fÃ©rences officielles Ã  intÃ©grer en /docs et dans le PDF : Service-Public (plus-value), impots.gouv (plus-values imposÃ©es), BOFiP (surtaxe), DGFiP (DMTO), Etalab/DVF.

2) Parcours UX â€” Wizard 6 Ã©tapes (verrouillÃ©)

Essentiels (blocants) :
RÃ´le (PP / SCI IR / SCI IS), Occupation (RP / RS / 1re vente + rÃ©emploi), Adresse (autocomplete), Commune/INSEE, DÃ©partement, Type (maison/appart/terrain/local), Prix & dates achat/vente.

Acquisition & travaux :
Frais dâ€™acquisition = forfait 7,5 % OU montant rÃ©el ; Travaux = forfait 15 % si dÃ©tention â‰¥ 5 ans OU rÃ©el (factures) ; Autres coÃ»ts achat.

Cession & financement :
CRD ; IRA = min(3 % du CRD ; 6 mois dâ€™intÃ©rÃªts) (taux annuel si Â« 6 mois Â») ; MainlevÃ©e ; Agence vendeur ; Diagnostics ; Prorata TF ; Divers.

SCI (si SCI) :
SCI IR : rien de plus ; SCI IS : VNC, frais de cession imputables, dividendes distribuÃ©s (PFU), seuil PME (15 %) paramÃ©trable.

Surface & DPE (facultatif) :
Tableau piÃ¨ces (nom, mÂ², hauteur, annexe âœ“) â†’ habitable (â‰¥1,80 m) & annexes ; infos DPE.

RÃ©sultats & export :
PV brute, abattements (IR/PS), IR, PS, surtaxe (barÃ¨me exact), exonÃ©rations, net vendeur & net en poche, alertes conformitÃ© (Annexe H), DVF comparables, Paywall, PDF/CSV, partage.

Panneau â€œRÃ©sultat liveâ€ sticky (colonne droite) sur toutes les Ã©tapes.

3) RÃ¨gles de calcul (normatives â€” sans approximation)

Base acquisition = prix achat + frais acquisition (forfait 7,5 % ou rÃ©el) + travaux (forfait 15 % si â‰¥ 5 ans ou rÃ©el) + autres.

PV brute = prix vente âˆ’ base acquisition.

DurÃ©e : annÃ©es pleines entre dates.

PP / SCI IR :

Abattements lÃ©gaux : IR exonÃ©rÃ© Ã  22 ans, PS Ã  30 ans (cadence officielle).

IR = base IR Ã— 19 % ; PS = base PS Ã— 17,2 %.

Surtaxe : si PV nette taxable IR > 50 000 â‚¬, appliquer barÃ¨me BOFiP exact (tranches + dÃ©cotes). â†’ Annexe A.

ExonÃ©rations : RP ; 1re vente autre que RP avec rÃ©emploi total sous 24 mois et non-propriÃ©taire de RP sur 4 ans. â†’ Annexe B.

SCI IS :

RÃ©sultat = prix âˆ’ (VNC + frais cession) ; IS : 15 % jusquâ€™au seuil PME (paramÃ©trable), 25 % au-delÃ  ; PFU 30 % si dividendes distribuÃ©s.

PrÃªt (IRA) : min(3 % Ã— CRD ; 6/12 Ã— CRD Ã— taux_annuel).

Net en poche = prix âˆ’ fiscalitÃ© âˆ’ CRD âˆ’ IRA âˆ’ mainlevÃ©e âˆ’ (agence + diag + prorata TF + divers).

DMTO (achats) : lire dmto_table (source DGFiP, versionnÃ©e) ; afficher version (date + source) dans lâ€™UI & le PDF ; rappeler que simulateur Notaires est la rÃ©fÃ©rence usager (notre estimation est informative).

DVF : renvoyer 3â€“5 comparables pertinents (INSEE, rayon km, pÃ©riode rÃ©cente), avec lien Etalab.

4) Architecture & livrables (monorepo)

apps/web â€” Next.js (App Router) + React + Tailwind + TypeScript : Wizard 6 Ã©tapes, panneau Â« rÃ©sultat live Â», alertes, paywall, exports PDF/CSV, partage, i18n FR, dark mode, A11Y AA.

apps/api â€” Node/Express + TS + Zod + Prisma (PostgreSQL) : API REST, JWT httpOnly, Stripe (one-shot + abo), S3, PDF (Puppeteer), proxy DVF + cache, logs, rate-limit, audit.

packages/calc-core â€” moteur pur (fonctions pures, sans rÃ©seau, testÃ© â‰¥ 95 %).

/docs â€” sources officielles, formules, RGPD, mentions lÃ©gales.

CI GitHub Actions â€” lint, typecheck, unit, e2e, preview deploy.

SchÃ©ma Postgres (Ã  implÃ©menter tel quel) :
users, properties, simulations, rooms, uploads, dmto_table (versionnÃ©e), dvf_cache, audit_logs, insee_dept (mini-seed).
(Types et colonnes dÃ©crits dans le CDC prÃ©cÃ©dent ; reprendre Ã  lâ€™identique.)

API REST (obligatoire) :

/auth (signup/login)

/dmto/:dept (retourne ligne + version + source)

/simulations CRUD + /simulations/:id/compute (appelle calc-core)

/dvf?insee=XXXXX&radius=KM&since=YYYY (proxy + cache)

/uploads (S3)

/export/pdf|csv

/audit/:simulation_id

Webhooks Stripe : one-shot et abonnements.

Paiement :

One-shot : 29â€“39 â‚¬ / simulation â†’ dÃ©verrouille PDF certifiÃ© (horodatage + QR code + versions barÃ¨mes/DMTO) + lien partage.

Abonnements : Standard / Pro / Cabinet (illimitÃ©, dossiers, exports, marque blanche).

PDF certifiÃ© (obligatoire) :

Inputs (synthÃ¨se), formules, rÃ©sultats (bases, IR, PS, surtaxe/IS/PFU), net en poche, versions & sources (BOFiP/Service-Public/impots.gouv/DGFiP/DVF), QR code vers la simulation, horodatage, bandeau lÃ©gal (Annexe F).

Empreinte (hash) des inputs + des versions stockÃ©e dans audit_logs.

5) Seeds & MCO

DMTO France entiÃ¨re : /seeds/dmto_table.csv (voir Annexe C : colonnes, modÃ¨le, exemple, process dâ€™ingestion). Source maÃ®tresse = PDF DGFiP ; lâ€™Admin charge le CSV et publie la version (visible en UI & PDF).

INSEE â‡„ dÃ©partements : mini-seed /seeds/insee_dept.csv (ex. Bouches-du-RhÃ´ne/Paris/RhÃ´ne/Gironde) â†’ en prod, remplacer par rÃ©fÃ©rentiel complet.

Admin user seed pour back-office.

MCO : update DMTO uniquement Ã  rÃ©ception dâ€™un nouveau PDF DGFiP â†’ nouvelle version publiÃ©e.

6) QualitÃ©, sÃ©curitÃ©, conformitÃ©

Unit tests (calc-core) : â‰¥ 95 % de couverture ; golden tests pour surtaxe BOFiP (cas par tranche + seuils de dÃ©cote).

E2E (Playwright) : 12 scÃ©narios obligatoires (Annexe D).

RGPD : hÃ©bergement UE, chiffrement at-rest/in-transit, purge documents (ex. 5 ans), droit dâ€™accÃ¨s/suppression, registre sous-traitants (hÃ©bergeur, Stripe, S3).

AccessibilitÃ© AA ; i18n FR (base).

ğŸ“ ANNEXES (Ã  implÃ©menter telles quelles)
Annexe A â€” Surtaxe (BOFiP) : barÃ¨me exact + dÃ©cotes

EntrÃ©e : PV = plus-value nette taxable IR (aprÃ¨s abattements â€” hors exonÃ©rations).
Assujettissement : surtaxe si PV > 50 000 â‚¬.
Formules par tranche (avec dÃ©cotes lÃ©gales ; implÃ©mentation stricte) :

Tranche PV (â‚¬)	Taxe Ã  appliquer
50 001 â€“ 60 000	0,02 Ã— PV âˆ’ (60 000 âˆ’ PV) Ã— 1/20
60 001 â€“ 100 000	0,02 Ã— PV
100 001 â€“ 110 000	0,03 Ã— PV âˆ’ (110 000 âˆ’ PV) Ã— 1/10
110 001 â€“ 150 000	0,03 Ã— PV
150 001 â€“ 160 000	0,04 Ã— PV âˆ’ (160 000 âˆ’ PV) Ã— 15/100
160 001 â€“ 200 000	0,04 Ã— PV
200 001 â€“ 210 000	0,05 Ã— PV âˆ’ (210 000 âˆ’ PV) Ã— 20/100
210 001 â€“ 250 000	0,05 Ã— PV
250 001 â€“ 260 000	0,06 Ã— PV âˆ’ (260 000 âˆ’ PV) Ã— 25/100
> 260 000	0,06 Ã— PV

Contraintes : calcul par cÃ©dant (quote-part), exclusions spÃ©cifiques si prÃ©vues par la doctrine.
Sorties : surtaxe_euros, tranche_label, version_bofip = { url, date }.
(Les exemples chiffrÃ©s BOFiP doivent Ãªtre reproduits en tests unitaires â€œgoldenâ€.)

Annexe B â€” ExonÃ©rations Ã  contrÃ´ler

RÃ©sidence principale (RP) : exonÃ©ration totale (IR, PS, surtaxe) ; les dÃ©pendances immÃ©diates et nÃ©cessaires cÃ©dÃ©es simultanÃ©ment suivent le rÃ©gime RP.
ContrÃ´le UI : case Â« RP Â» + micro-texte rappelant lâ€™occupation effective jusquâ€™Ã  la cession.

1re vente autre que RP + rÃ©emploi (CGI 150 U II-1Â° bis) :

(a) CÃ©dant non-propriÃ©taire de sa RP durant les 4 annÃ©es prÃ©cÃ©dant la cession ;

(b) RÃ©emploi total du prix dans lâ€™acquisition/construction de la RP sous 24 mois (travaux admissibles).
ContrÃ´le UI : case Â« rÃ©emploi total Â» obligatoire ; sinon alerte et imposition.

Annexe C â€” DMTO France entiÃ¨re (DGFiP) : CSV & ingestion

Source maÃ®tresse : PDF DGFiP listant les taux applicables par dÃ©partement (dates dâ€™effet).
Colonnes CSV (sÃ©parateur ,, dÃ©cimales .) :

dept_code,dept_name,dmto_rate,commune_rate,state_addition,total_transfer,notary_fees_base,notary_fixed,version,effective_from,effective_to,source_url


dmto_rate : part dÃ©partementale (ex : 5.00), issue du PDF DGFiP.

commune_rate, state_addition, total_transfer : composants estimatifs pour les frais dâ€™acquisition.

notary_fees_base (ex : 0.80) & notary_fixed (ex : 1000.00) : indications dâ€™Ã©moluments et dÃ©bours (estimation).

version = â€œYYYY-MMâ€ ; effective_from = â€œYYYY-MM-DDâ€ ; source_url = lien DGFiP.

Extrait de seed (Ã  complÃ©ter France entiÃ¨re depuis DGFiP) :

13,Bouches-du-RhÃ´ne,5.00,1.20,0.10,6.30,0.80,1000.00,2025-06,2025-06-01,,https://www.impots.gouv.fr/droits-denregistrement-consulter-les-taux-abattements-et-exonerations
75,Paris,5.00,1.20,0.10,6.30,0.80,1000.00,2025-06,2025-06-01,,https://www.impots.gouv.fr/droits-denregistrement-consulter-les-taux-abattements-et-exonerations
33,Gironde,5.00,1.20,0.10,6.30,0.80,1000.00,2025-06,2025-06-01,,https://www.impots.gouv.fr/droits-denregistrement-consulter-les-taux-abattements-et-exonerations
69,RhÃ´ne,5.00,1.20,0.10,6.30,0.80,1000.00,2025-06,2025-06-01,,https://www.impots.gouv.fr/droits-denregistrement-consulter-les-taux-abattements-et-exonerations


Ingestion & publication :

Back-office Admin â†’ upload CSV â†’ remplit dmto_table â†’ Publier version vYYYY-MM.

Lâ€™UI et le PDF affichent la version + source_url.

MCO : mise Ã  jour uniquement Ã  rÃ©ception dâ€™un nouveau PDF DGFiP.

Annexe D â€” Batterie de tests (obligatoire)

Unit tests (packages/calc-core) : couverture â‰¥ 95 %

Abattements durÃ©e : 4 ans (0 %), 7 ans, 21 ans, 22 ans (IR 0), 30 ans (PS 0).

Surtaxe : 1 test par tranche + tests sur seuils de dÃ©cote (reproduire les exemples BOFiP).

RP : exonÃ©ration totale.

1re vente + rÃ©emploi : âœ“ (rÃ©emploi total â‰¤ 24 mois & non-propr. RP 4 ans) â†’ 0 ; âœ— â†’ imposable.

SCI IS : cas VNC, seuil 15 %/25 %, dividendes PFU.

IRA : cas oÃ¹ 3 % < 6 mois ; et cas inverse.

DMTO : 3 dÃ©partements (4,5 % vs 5,0 %) â†’ estimation diffÃ©rente, version visible.

E2E (Playwright) : 12 scÃ©narios
RP (exonÃ©rÃ©) ; RS 7 ans (IR/PS) ; surtaxe 55 kâ‚¬ (dÃ©cote) ; 1re vente + rÃ©emploi âœ“/âœ— ; SCI IS ; CRD+IRA (2 modes) ; DMTO 4,5 vs 5,0 ; DVF (3â€“5 comparables) ; paywall one-shot â†’ PDF ; export CSV ; partage lien ; Admin publie nouvelle version DMTO â†’ visible en front & PDF.

Annexe E â€” Mini-seed INSEE â‡„ dÃ©partements

CrÃ©er insee_dept(code_commune_insee, dept_code, commune_name) + charger un mini-seed (13/75/69/33). En prod, remplacer par rÃ©fÃ©rentiel INSEE complet.

Annexe F â€” Mentions lÃ©gales (PDF & site)

Bandeau PDF

â€œSimulation indicative â€” ce document ne se substitue pas Ã  lâ€™avis et aux actes dâ€™un Notaire. Les calculs sâ€™appuient sur les sources officielles citÃ©es et sur les donnÃ©es saisies par lâ€™utilisateur, sous sa responsabilitÃ©.â€

Sources Ã  afficher dans le PDF

Plus-value & taux : Service-Public ; impots.gouv.

Surtaxe : BOFiP â€” barÃ¨me + dÃ©cotes.

DMTO : DGFiP â€” tableau des taux (version affichÃ©e).

Comparables : DVF Etalab/DGFiP (liens).

Privacy/CGU (rÃ©sumÃ©) : finalitÃ© de simulation ; conservation X ans (simus) / 5 ans (docs) ; hÃ©bergement UE ; chiffrement ; sous-traitants (hÃ©bergeur, Stripe, S3) ; droits RGPD (accÃ¨s, suppression).

Annexe G â€” Back-office Admin (spÃ©c Ã©crans)

DMTO : liste (dept, taux, version) ; import CSV ; bouton Â« Publier vYYYY-MM Â».

Surtaxe : champs url_bofip + date_version affichÃ©s (lecture/Ã©dition si MAJ lien).

Mentions : Ã©diteur rich-text (bandeau lÃ©gal, CGU/Privacy).

DVF : purge cache par INSEE/pÃ©riode ; journal dâ€™appels.

Stripe : logs webhooks, rÃ©Ã©mission.

Audit : tableau audit_logs (hash inputs + versions, timestamp, user).

RÃ´les : admin, pro, user. RLS activÃ©e (si infra supporte).

Annexe H â€” Messages dâ€™alerte UX (texte exact)

Forfait 15 % inÃ©ligible :
â€œâš ï¸ Le forfait 15 % nâ€™est applicable quâ€™avec une dÃ©tention dâ€™au moins 5 ans. Passez en â€˜Montant rÃ©elâ€™ ou modifiez la date dâ€™achat.â€

1re vente + rÃ©emploi incomplet :
â€œâš ï¸ Lâ€™exonÃ©ration â€˜1re vente + rÃ©emploiâ€™ exige le rÃ©emploi total du prix dans la RP sous 24 mois et lâ€™absence de propriÃ©tÃ© dâ€™une RP dans les 4 annÃ©es prÃ©cÃ©dant la cession. Corrigez vos cases ou choisissez â€˜RÃ©sidence secondaireâ€™.â€

Surtaxe :
â€œâ„¹ï¸ Votre plus-value nette taxable IR dÃ©passe 50 000 â‚¬. La surtaxe est calculÃ©e selon le barÃ¨me BOFiP (voir PDF).â€

RP incohÃ©rence potentielle :
â€œâš ï¸ La RP nÃ©cessite une occupation effective jusquâ€™Ã  la cession et lâ€™inclusion de dÃ©pendances simultanÃ©ment. VÃ©rifiez vos donnÃ©es.â€

DMTO (info) :
â€œâ„¹ï¸ Les frais dâ€™acquisition sont estimÃ©s dâ€™aprÃ¨s le tableau DGFiP (version affichÃ©e). Lâ€™outil des Notaires de France demeure la rÃ©fÃ©rence usager.â€

IRA :
â€œâ„¹ï¸ Lâ€™indemnitÃ© de remboursement anticipÃ© est le minimum entre 3 % du capital restant dÃ» et 6 mois dâ€™intÃ©rÃªts (taux annuel).â€

7) Plan dâ€™exÃ©cution (ordre impÃ©ratif)

packages/calc-core : abattements 22/30 ans ; surtaxe BOFiP (Annexe A) ; exonÃ©rations (Annexe B) ; IRA ; net en poche ; estimateNotaryFees(dept) lisant DMTO ; helpers surface. Unit tests â‰¥ 95 %.

apps/api : endpoints + Zod ; Stripe one-shot & abo ; DVF proxy + cache ; PDF Puppeteer ; S3 ; JWT ; logs ; rate-limit ; audit.

apps/web : Wizard 6 Ã©tapes ; rÃ©sultat live ; alertes (Annexe H) ; paywall ; exports ; partage.

Back-office : Admin DMTO + Surtaxe + Mentions + DVF cache + Stripe webhooks (Annexe G).

Seeds : dmto_table.csv (France entiÃ¨re, depuis PDF DGFiP), insee_dept.csv (mini), users_admin.sql.

CI/CD & Docs : pipeline vert ; /docs (sources, formules, RGPD, limites).

8) CritÃ¨res dâ€™acceptation (bloquants)

Surtaxe = rÃ©sultat au centime selon barÃ¨me BOFiP (tests par tranches + dÃ©cotes).

DMTO : table chargÃ©e depuis PDF DGFiP ; version & source visibles en UI & PDF.

IR 19 %, PS 17,2 %, abattements 22/30 ans conformes.

One-shot Stripe dÃ©bloque PDF certifiÃ© (horodatage + QR + versions).

DVF : 3â€“5 comparables pertinents avec liens Etalab.

Unit tests â‰¥ 95 % ; 12 e2e OK ; A11Y AA ; i18n FR ; RGPD.

âœ”ï¸ CHECKLIST de fin (Ã  cocher avant livraison)

 calc-core (95 %+) : abattements, surtaxe BOFiP, exonÃ©rations, IRA, net, DMTO, surface.

 API : endpoints, Zod, Stripe (one-shot & abo), DVF cache/proxy, PDF certifiÃ©, audit.

 Web : Wizard 6 Ã©tapes, panneau live, alertes, paywall, exports, partage.

 Admin : DMTO (import & publier version), Surtaxe (URL/date), Mentions, DVF cache, webhooks Stripe.

 Seeds : dmto_table.csv FR entiÃ¨re (depuis PDF DGFiP), insee_dept.csv (mini), users_admin.sql.

 CI/CD : lint, typecheck, unit, e2e, preview â†’ vert.

 /docs : sources, formules, RGPD, limites, mentions lÃ©gales.

Fin du prompt.